{
  "info": {
    "name": "StudioForRent API - Booking Tests",
    "_postman_id": "studioforrent-booking-collection",
    "description": "Complete test collection for all booking functions",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login as Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Login successful', () => pm.expect(res.success).to.be.true);",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('customerToken', res.data.accessToken);",
                  "}",
                  "if (res.data && res.data.user && res.data.user._id) {",
                  "  pm.environment.set('customerId', res.data.user._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{customerUsername}}\",\n  \"password\": \"{{customerPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          },
          "response": []
        },
        {
          "name": "Login as Staff",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Login successful', () => pm.expect(res.success).to.be.true);",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('staffToken', res.data.accessToken);",
                  "}",
                  "if (res.data && res.data.user && res.data.user._id) {",
                  "  pm.environment.set('staffId', res.data.user._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{staffUsername}}\",\n  \"password\": \"{{staffPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Create",
      "item": [
        {
          "name": "Create Booking with Schedule ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Booking created', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has booking data', () => pm.expect(res.data).to.exist);",
                  "if (res.data && res.data._id) {",
                  "  pm.environment.set('bookingId', res.data._id);",
                  "  pm.test('Booking has ID', () => pm.expect(res.data._id).to.exist);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"scheduleId\": \"{{testScheduleId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Create Booking with Studio & Times",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Booking created', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Schedule auto-created', () => pm.expect(res.data.scheduleId).to.exist);",
                  "if (res.data && res.data._id) {",
                  "  pm.environment.set('bookingId2', res.data._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"studioId\": \"{{testStudioId}}\",\n  \"startTime\": \"{{testStartTime}}\",\n  \"endTime\": \"{{testEndTime}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Create Booking with Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Booking created', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has total amount', () => pm.expect(res.data.finalAmount).to.exist);",
                  "pm.test('Total > 0', () => pm.expect(res.data.finalAmount).to.be.above(0));",
                  "if (res.data && res.data._id) {",
                  "  pm.environment.set('bookingId3', res.data._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"studioId\": \"{{testStudioId}}\",\n  \"startTime\": \"{{testStartTime2}}\",\n  \"endTime\": \"{{testEndTime2}}\",\n  \"details\": [\n    {\n      \"detailType\": \"equipment\",\n      \"equipmentId\": \"{{testEquipmentId}}\",\n      \"quantity\": 2\n    },\n    {\n      \"detailType\": \"extra_service\",\n      \"extraServiceId\": \"{{testServiceId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Create Booking with Promotion",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Booking created', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has discount', () => pm.expect(res.data.discountAmount).to.exist);",
                  "pm.test('Discount applied', () => pm.expect(res.data.discountAmount).to.be.above(0));",
                  "pm.test('Final < Before discount', () => {",
                  "  pm.expect(res.data.finalAmount).to.be.below(res.data.totalBeforeDiscount);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"studioId\": \"{{testStudioId}}\",\n  \"startTime\": \"{{testStartTime3}}\",\n  \"endTime\": \"{{testEndTime3}}\",\n  \"promoId\": \"{{testPromoId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Read",
      "item": [
        {
          "name": "Get All My Bookings",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has data', () => pm.expect(res.data).to.exist);",
                  "pm.test('Is array or has items', () => {",
                  "  const items = res.data.items || res.data;",
                  "  pm.expect(items).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Get Bookings with Status Filter",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('All have PENDING status', () => {",
                  "  const items = res.data.items || res.data;",
                  "  if (items.length > 0) {",
                  "    items.forEach(b => pm.expect(b.status).to.equal('PENDING'));",
                  "  }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings?status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDING"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Single Booking by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has booking data', () => pm.expect(res.data).to.exist);",
                  "pm.test('Has booking ID', () => pm.expect(res.data._id).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Get Booking with Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has details array', () => pm.expect(res.data.details).to.be.an('array'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId3}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId3}}"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Add Details",
      "item": [
        {
          "name": "Add Equipment to Booking",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has details', () => pm.expect(res.data.details).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"details\": [\n    {\n      \"detailType\": \"equipment\",\n      \"equipmentId\": \"{{testEquipmentId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}/details",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}", "details"]
            }
          },
          "response": []
        },
        {
          "name": "Add Service to Booking",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"details\": [\n    {\n      \"detailType\": \"extra_service\",\n      \"extraServiceId\": \"{{testServiceId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}/details",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}", "details"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Update (Staff)",
      "item": [
        {
          "name": "Update Booking Times",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Booking updated', () => pm.expect(res.data).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"startTime\": \"{{updateStartTime}}\",\n  \"endTime\": \"{{updateEndTime}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Update Booking Promotion",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Discount recalculated', () => pm.expect(res.data.discountAmount).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"promoId\": \"{{testPromoId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId2}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId2}}"]
            }
          },
          "response": []
        },
        {
          "name": "Update - Add Detail via Update",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"addDetails\": [\n    {\n      \"detailType\": \"equipment\",\n      \"equipmentId\": \"{{testEquipmentId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId2}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId2}}"]
            }
          },
          "response": []
        },
        {
          "name": "Update - Customer Forbidden",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403 Forbidden', () => pm.response.to.have.status(403));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"startTime\": \"{{updateStartTime}}\",\n  \"endTime\": \"{{updateEndTime}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Confirm (Staff)",
      "item": [
        {
          "name": "Confirm Booking",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Status confirmed', () => pm.expect(res.data.status).to.equal('CONFIRMED'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId3}}/confirm",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId3}}", "confirm"]
            }
          },
          "response": []
        },
        {
          "name": "Confirm - Customer Forbidden",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403 Forbidden', () => pm.response.to.have.status(403));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId2}}/confirm",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId2}}", "confirm"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking - Cancel",
      "item": [
        {
          "name": "Cancel Booking",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Success', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Status cancelled', () => pm.expect(res.data.status).to.equal('CANCELLED'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId}}", "cancel"]
            }
          },
          "response": []
        },
        {
          "name": "Cancel - Equipment Released",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Cancelled successfully', () => pm.expect(res.data.status).to.equal('CANCELLED'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/{{bookingId2}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "{{bookingId2}}", "cancel"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Edge Cases",
      "item": [
        {
          "name": "Conflict - Overlapping Schedule",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 409 Conflict', () => pm.response.to.have.status(409));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"studioId\": \"{{testStudioId}}\",\n  \"startTime\": \"{{testStartTime}}\",\n  \"endTime\": \"{{testEndTime}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Conflict - 30min Gap Violation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 409 Conflict', () => pm.response.to.have.status(409));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"studioId\": \"{{testStudioId}}\",\n  \"startTime\": \"{{gapViolationStart}}\",\n  \"endTime\": \"{{gapViolationEnd}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        },
        {
          "name": "Invalid Booking ID - 404",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 404 Not Found', () => pm.response.to.have.status(404));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/bookings/507f1f77bcf86cd799439011",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings", "507f1f77bcf86cd799439011"]
            }
          },
          "response": []
        },
        {
          "name": "Unauthorized - No Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401 Unauthorized', () => pm.response.to.have.status(401));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/bookings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bookings"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "AI SetDesign",
      "item": [
        {
          "name": "Generate AI Design (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('AI design generated', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has suggestions', () => pm.expect(res.data.suggestions).to.be.an('array'));",
                  "pm.test('Has 3 design concepts', () => pm.expect(res.data.suggestions).to.have.lengthOf(3));",
                  "if (res.data && res.data.setDesignId) {",
                  "  pm.environment.set('setDesignId', res.data.setDesignId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"theme\": \"wedding photography\",\n  \"style\": \"romantic and elegant\",\n  \"colors\": \"white, gold, pink\",\n  \"mood\": \"dreamy and sophisticated\",\n  \"lighting\": \"soft natural light with golden hour warmth\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/generate/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "generate", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Get AI Iterations (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has iterations', () => pm.expect(res.data).to.be.an('array'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/iterations",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "iterations"]
            }
          },
          "response": []
        },
        {
          "name": "Get AI Iterations (Staff)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Staff can view iterations', () => pm.expect(res.data).to.be.an('array'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/iterations",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "iterations"]
            }
          },
          "response": []
        },
        {
          "name": "Select Final Design (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Design selected', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has final design', () => pm.expect(res.data.finalDesign).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"iterationIndex\": 0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/select",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "select"]
            }
          },
          "response": []
        },
        {
          "name": "Generate Props Recommendations (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Props recommendations generated', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has recommended props', () => pm.expect(res.data.recommendedProps).to.be.an('array'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/props",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "props"]
            }
          },
          "response": []
        },
        {
          "name": "Get SetDesign Details (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has setDesign data', () => pm.expect(res.data).to.exist);",
                  "pm.test('Has booking reference', () => pm.expect(res.data.bookingId).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Get SetDesign Details (Staff)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Staff can view setDesign', () => pm.expect(res.data).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Update SetDesign Status (Staff)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Status updated', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has updated status', () => pm.expect(res.data.status).to.equal('staff_confirmed'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"staff_confirmed\",\n  \"staffNotes\": \"Design approved, will implement tomorrow\",\n  \"finalPrice\": 500000\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "status"]
            }
          },
          "response": []
        },
        {
          "name": "Get SetDesign by Booking (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has setDesign for booking', () => pm.expect(res.data).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/booking/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "booking", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Start Conversation (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Chat started successfully', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has AI response', () => pm.expect(res.data.aiMessage).to.exist);",
                  "pm.test('Has chat history', () => pm.expect(res.data.chatHistory).to.be.an('array'));",
                  "pm.test('Chat history has 2 messages', () => pm.expect(res.data.chatHistory.length).to.equal(2));",
                  "pm.test('Cannot generate yet', () => pm.expect(res.data.canGenerateDesigns).to.be.false);",
                  "if (res.data && res.data.setDesignId) {",
                  "  pm.environment.set('setDesignId', res.data.setDesignId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Hi! I need help designing a photoshoot setup\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Provide Theme (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has AI response', () => pm.expect(res.data.aiMessage).to.exist);",
                  "pm.test('Chat history growing', () => pm.expect(res.data.chatHistory.length).to.be.greaterThan(2));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"I want a romantic wedding photoshoot\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Provide Colors (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has AI response', () => pm.expect(res.data.aiMessage).to.exist);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"I like white, gold, and soft pink colors\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Provide Mood (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has AI response', () => pm.expect(res.data.aiMessage).to.exist);",
                  "pm.test('Can generate designs now', () => pm.expect(res.data.canGenerateDesigns).to.be.true);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"I want dreamy and elegant lighting\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Get Chat History (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Has chat history', () => pm.expect(res.data.chatHistory).to.be.an('array'));",
                  "pm.test('Has messages', () => pm.expect(res.data.messageCount).to.be.greaterThan(0));",
                  "pm.test('Is drafting status', () => pm.expect(res.data.status).to.equal('drafting'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{bookingId}}/chat-history",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{bookingId}}", "chat-history"]
            }
          },
          "response": []
        },
        {
          "name": "Generate from Chat (Customer)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 201', () => pm.response.to.have.status(201));",
                  "pm.test('Designs generated from chat', () => pm.expect(res.success).to.be.true);",
                  "pm.test('Has 3 suggestions', () => pm.expect(res.data.suggestions).to.have.lengthOf(3));",
                  "pm.test('Has conversation summary', () => pm.expect(res.data.conversationSummary).to.exist);",
                  "if (res.data && res.data.setDesignId) {",
                  "  pm.environment.set('setDesignId', res.data.setDesignId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/generate-from-chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "generate-from-chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Empty Message (Validation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 Bad Request', () => pm.response.to.have.status(400));",
                  "const res = pm.response.json();",
                  "pm.test('Error about empty message', () => pm.expect(res.message).to.include('message'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Message Too Long (Validation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 Bad Request', () => pm.response.to.have.status(400));",
                  "const res = pm.response.json();",
                  "pm.test('Error about message length', () => pm.expect(res.message).to.include('qu di'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Chat - Staff Cannot Chat (Unauthorized)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403 Forbidden', () => pm.response.to.have.status(403));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Hello\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/chat/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "chat", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Get Chat History (Staff - Can View)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Staff can view chat history', () => pm.expect(res.data.chatHistory).to.be.an('array'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{bookingId}}/chat-history",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{bookingId}}", "chat-history"]
            }
          },
          "response": []
        },
        {
          "name": "Rate Limit Test - AI Generation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// After 5 requests in 15 minutes, should get 429",
                  "pm.test('Rate limit enforced', () => {",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 429]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"theme\": \"portrait photography\",\n  \"style\": \"professional\",\n  \"lighting\": \"studio lighting\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/generate/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "generate", "{{bookingId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Unauthorized - Customer Cannot Update Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403 Forbidden', () => pm.response.to.have.status(403));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{customerToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"staff_confirmed\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/{{setDesignId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "{{setDesignId}}", "status"]
            }
          },
          "response": []
        },
        {
          "name": "Unauthorized - Staff Cannot Generate AI",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403 Forbidden', () => pm.response.to.have.status(403));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{staffToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"theme\": \"wedding\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/set-designs/generate/{{bookingId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "set-designs", "generate", "{{bookingId}}"]
            }
          },
          "response": []
        }
      ]
    }
  ]
}

node.exe : 
At C:\Program Files\nodejs\npm.ps1:29 char:3
+   & $NODE_EXE $NPM_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
> be@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js

(node:4124) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:12296) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:30968) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:27536) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:29268) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:11360) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:28456) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:31036) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:20920) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/unit/services/user.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 23 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 24 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 25 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 26 |[39m
     [90m 27 |[39m describe([32m'User Service'[39m[33m,[39m () [33m=>[39m {
     [90m 28 |[39m   [90m// #region Customer Profile Tests[39m[0m

      at require (src/tests/unit/services/user.service.test.js:25:5)
      at _getJestObj (src/tests/unit/services/user.service.test.js:23:1)

(node:27304) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/unit/services/studio.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 30 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 31 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 32 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 33 |[39m
     [90m 34 |[39m describe([32m'Studio Service'[39m[33m,[39m () [33m=>[39m {
     [90m 35 |[39m   [90m// #region Get Studios Tests[39m[0m

      at require (src/tests/unit/services/studio.service.test.js:32:5)
      at _getJestObj (src/tests/unit/services/studio.service.test.js:24:1)

(node:30912) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/unit/services/review.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 24 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 25 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue({})[33m,[39m
    [31m[1m>[22m[39m[90m 26 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 27 |[39m
     [90m 28 |[39m describe([32m'Review Service'[39m[33m,[39m () [33m=>[39m {
     [90m 29 |[39m   [36mlet[39m customer[33m,[39m admin[33m,[39m studio[33m,[39m booking[33m;[39m[0m

      at require (src/tests/unit/services/review.service.test.js:26:5)
      at _getJestObj (src/tests/unit/services/review.service.test.js:24:1)

(node:26572) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL src/tests/unit/utils/errors.test.js
  Custom Errors
    AppError
      ΓêÜ should create error with message and status code (10 ms)
      ├ù should capture stack trace (15 ms)
      ΓêÜ should work with different status codes (1 ms)
    ApiError (Alias)
      ΓêÜ should be an alias for AppError (1 ms)
      ΓêÜ should create error same as AppError (1 ms)
    NotFoundError
      ΓêÜ should create 404 error with default message (1 ms)
      ΓêÜ should create 404 error with custom message
      ├ù should capture stack trace (1 ms)
    BadRequestError
      ΓêÜ should create 400 error with default message (2 ms)
      ΓêÜ should create 400 error with custom message (1 ms)
    ValidationError
      ΓêÜ should create 400 error with default message (1 ms)
      ΓêÜ should create 400 error with custom message (3 ms)
      ΓêÜ should be distinct from BadRequestError
    UnauthorizedError
      ΓêÜ should create 401 error with default message (1 ms)
      ΓêÜ should create 401 error with custom message (1 ms)
    ForbiddenError
      ΓêÜ should create 403 error with default message
      ΓêÜ should create 403 error with custom message
    ConflictError
      ΓêÜ should create 409 error with default message (1 ms)
      ΓêÜ should create 409 error with custom message (1 ms)
    Error Hierarchy
      ΓêÜ all custom errors should extend AppError (1 ms)
      ΓêÜ errors should have correct status codes (1 ms)

  ΓùÅ Custom Errors ΓÇ║ AppError ΓÇ║ should capture stack trace

    expect(received).toContain(expected) // indexOf

    Expected substring: "AppError"
    Received string:    "Error: Test error

    [0m [90m 29 |[39m
     [90m 30 |[39m     it([32m'should capture stack trace'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mAppError[39m([32m'Test error'[39m[33m,[39m 
[35m400[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 32 |[39m       expect(error[33m.[39mstack)[33m.[39mtoBeDefined()[33m;[39m
     [90m 33 |[39m       expect(error[33m.[39mstack)[33m.[39mtoContain([32m'AppError'[39m)[33m;[39m
     [90m 34 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/tests/unit/utils/errors.test.js:31:21)
      at Object.toContain (src/tests/unit/utils/errors.test.js:33:27)

  ΓùÅ Custom Errors ΓÇ║ NotFoundError ΓÇ║ should capture stack trace

    expect(received).toContain(expected) // indexOf

    Expected substring: "NotFoundError"
    Received string:    "Error: Studio not found

    [0m [90m 78 |[39m
     [90m 79 |[39m     it([32m'should capture stack trace'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 80 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mNotFoundError[39m([32m'Studio not 
found'[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 81 |[39m       expect(error[33m.[39mstack)[33m.[39mtoContain([32m'NotFoundError'[39m)[33m;[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/tests/unit/utils/errors.test.js:80:21)
      at Object.toContain (src/tests/unit/utils/errors.test.js:81:27)

FAIL src/tests/unit/services/promotion.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/promotion.service.js' does not provide an export named 'togglePromotionActive'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:29736) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [34mΓä╣[0m [2025-12-10T19:30:04.708Z] INFO: Cloudinary configuration validated successfully

      at Object.log [as info] (src/utils/logger.js:21:15)

FAIL src/tests/unit/utils/validators.test.js
  Validators
    isValidEmail
      ΓêÜ should return true for valid email formats (7 ms)
      ΓêÜ should return false for invalid email formats (2 ms)
      ΓêÜ should return false for null or undefined
    isValidPassword
      ΓêÜ should return true for strong passwords (1 ms)
      ΓêÜ should return false for weak passwords (1 ms)
      ΓêÜ should return false for null or undefined (1 ms)
    isValidPhone
      ΓêÜ should return true for valid Vietnamese phone numbers
      ΓêÜ should return false for invalid phone numbers
      ΓêÜ should return false for null or undefined (1 ms)
    isValidVerificationCode
      ΓêÜ should return true for valid 6-digit codes
      ΓêÜ should return false for invalid codes
      ΓêÜ should return false for null or undefined (1 ms)
    isNotEmpty
      ΓêÜ should return true for non-empty strings (1 ms)
      ├ù should return false for empty or whitespace-only strings (3 ms)
      ├ù should return false for null or undefined (1 ms)
    isPositiveNumber
      ΓêÜ should return true for positive numbers (1 ms)
      ΓêÜ should return false for zero and negative numbers
      ΓêÜ should return false for non-number types (3 ms)
    isValidObjectId
      ΓêÜ should return true for valid MongoDB ObjectIds (8 ms)
      ΓêÜ should return false for invalid ObjectIds
      ΓêÜ should return false for null or undefined (1 ms)

  ΓùÅ Validators ΓÇ║ isNotEmpty ΓÇ║ should return false for empty or whitespace-only strings

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: ""

    [0m [90m 125 |[39m
     [90m 126 |[39m     it([32m'should return false for empty or whitespace-only strings'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 127 |[39m       expect(isNotEmpty([32m''[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 128 |[39m       expect(isNotEmpty([32m'   '[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 129 |[39m       expect(isNotEmpty([32m'\t'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 130 |[39m       expect(isNotEmpty([32m'\n'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m[0m

      at Object.toBe (src/tests/unit/utils/validators.test.js:127:30)

  ΓùÅ Validators ΓÇ║ isNotEmpty ΓÇ║ should return false for null or undefined

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: null

    [0m [90m 132 |[39m
     [90m 133 |[39m     it([32m'should return false for null or undefined'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 134 |[39m       expect(isNotEmpty([36mnull[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 135 |[39m       expect(isNotEmpty(undefined))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 136 |[39m     })[33m;[39m
     [90m 137 |[39m   })[33m;[39m[0m

      at Object.toBe (src/tests/unit/utils/validators.test.js:134:32)

(node:29968) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS src/tests/unit/utils/helpers.test.js
  Helpers
    generateVerificationCode
      ΓêÜ should generate a 6-digit code by default (9 ms)
      ΓêÜ should generate codes of specified length (2 ms)
      ΓêÜ should generate unique codes (3 ms)
      ΓêÜ should not generate codes starting with 0 that would lose leading zeros (8 ms)
    getExpiryTime
      ΓêÜ should return timestamp in the future (1 ms)
      ΓêÜ should add correct minutes to current time (2 ms)
      ΓêÜ should use default expiry time when no argument provided
    isExpired
      ΓêÜ should return true for past timestamps
      ΓêÜ should return false for future timestamps (3 ms)
      ΓêÜ should handle Date objects (1 ms)
    formatDate
      ΓêÜ should format Date object to ISO string (3 ms)
      ΓêÜ should format timestamp to ISO string (1 ms)
      ΓêÜ should format date string to ISO string (1 ms)
    sanitizeUser
      ΓêÜ should remove default sensitive fields (3 ms)
      ΓêÜ should remove custom sensitive fields
      ΓêÜ should not modify original object (2 ms)
    toUserResponse
      ΓêÜ should transform user document to response object (1 ms)
      ΓêÜ should handle mongoose document with toObject method (6 ms)
      ΓêÜ should default role to customer if not provided (1 ms)
      ΓêÜ should default isActive to true if not provided (1 ms)
    createResponse
      ΓêÜ should create success response with data (1 ms)
      ΓêÜ should create error response (2 ms)
      ΓêÜ should not include data property when data is null (1 ms)
    delay
      ΓêÜ should delay execution for specified milliseconds (120 ms)
      ΓêÜ should return a promise (1 ms)
    slugify
      ΓêÜ should convert string to lowercase slug (1 ms)
      ΓêÜ should remove special characters (4 ms)
      ΓêÜ should handle multiple spaces and dashes (3 ms)
      ΓêÜ should trim leading and trailing dashes (1 ms)
      ΓêÜ should handle empty strings (2 ms)
    randomElement
      ΓêÜ should return an element from the array (13 ms)
      ΓêÜ should return the only element for single-element array (2 ms)
      ΓêÜ should return different elements over multiple calls (1 ms)
    sum
      ΓêÜ should sum positive numbers
      ΓêÜ should sum negative numbers
      ΓêÜ should sum mixed numbers (1 ms)
      ΓêÜ should return 0 for empty array (45 ms)
      ΓêÜ should handle decimal numbers (1 ms)
    groupBy
      ΓêÜ should group objects by key
      ΓêÜ should return empty object for empty array
      ΓêÜ should handle undefined keys (1 ms)
    escapeRegex
      ΓêÜ should escape special regex characters (4 ms)
      ΓêÜ should not modify strings without special characters
      ΓêÜ should escape complex patterns (1 ms)
      ΓêÜ should be safe for use in RegExp (1 ms)

FAIL src/tests/unit/services/notification.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/notification.service.js' does not provide an export named 'createNotification'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

FAIL src/tests/unit/services/roomPolicy.service.test.js
  RoomPolicy Service
    getAllPolicies
      ├ù should return all policies with pagination (89 ms)
      ├ù should filter by type (13 ms)
      ├ù should filter by isActive (17 ms)
      ├ù should search by name (9 ms)
      ├ù should search by description (6 ms)
      ├ù should handle pagination correctly (6 ms)
      ├ù should handle invalid page number (5 ms)
    createPolicy
      ├ù should create cancellation policy (4 ms)
      ├ù should create no-show policy (4 ms)
    getPolicyById
      ├ù should return policy by id (4 ms)
      ├ù should throw error for non-existent policy (33 ms)
    getPoliciesByType
      ├ù should return active policies by type (5 ms)
      ├ù should return inactive policies when specified (4 ms)
    calculateRefund
      ΓêÜ should return 100% refund for cancellation 72 hours before (2 ms)
      ΓêÜ should return 50% refund for cancellation 36 hours before (2 ms)
      ΓêÜ should return 25% refund for cancellation 20 hours before (2 ms)
      ΓêÜ should return 0% refund for cancellation 6 hours before (2 ms)
      ├ù should throw error for invalid policy type (9 ms)
      ├ù should throw error for null policy (12 ms)
    calculateNoShowCharge
      ΓêÜ should charge full amount for FULL_CHARGE type (13 ms)
      ΓêÜ should charge partial amount for PARTIAL_CHARGE type (6 ms)
      ΓêÜ should not charge if within grace period (1 ms)
      ΓêÜ should charge if grace period exceeded (2 ms)
      ΓêÜ should forgive first-time no-show (2 ms)
      ΓêÜ should charge after exceeding forgiveness limit (2 ms)
      ΓêÜ should not charge if customer checked in on time (1 ms)
      ├ù should throw error for invalid policy type (7 ms)
      ├ù should throw error for unknown charge type (5 ms)
    updatePolicy
      ├ù should update policy (3 ms)
      ├ù should throw error for non-existent policy (13 ms)
    deletePolicy
      ├ù should soft delete policy by setting isActive to false (3 ms)
      ├ù should throw error for non-existent policy (8 ms)
    getAllActivePolicies
      ├ù should return active policies grouped by type (6 ms)
      ├ù should not include inactive policies (3 ms)

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should return all policies with pagination

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should filter by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should filter by isActive

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should search by name

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should search by description

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should handle pagination correctly

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should handle invalid page number

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ createPolicy ΓÇ║ should create cancellation policy

    400

    [0m [90m 70 |[39m       [36mreturn[39m policy[33m;[39m
     [90m 71 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 72 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to create policy: 
${error.message}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 73 |[39m     }
     [90m 74 |[39m   }
     [90m 75 |[39m[0m

      at RoomPolicyService.createPolicy (src/services/roomPolicy.service.js:72:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:103:22)

  ΓùÅ RoomPolicy Service ΓÇ║ createPolicy ΓÇ║ should create no-show policy

    400

    [0m [90m 70 |[39m       [36mreturn[39m policy[33m;[39m
     [90m 71 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 72 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to create policy: 
${error.message}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 73 |[39m     }
     [90m 74 |[39m   }
     [90m 75 |[39m[0m

      at RoomPolicyService.createPolicy (src/services/roomPolicy.service.js:72:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:120:22)

  ΓùÅ RoomPolicy Service ΓÇ║ getPolicyById ΓÇ║ should return policy by id

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getPolicyById ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "500"

        [0m [90m 85 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 86 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 87 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m500[39m[33m,[39m [32m`Failed to get policy: 
${error.message}`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 88 |[39m     }
         [90m 89 |[39m   }
         [90m 90 |[39m[0m

      at RoomPolicyService.getPolicyById (src/services/roomPolicy.service.js:87:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:154:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:156:10)

  ΓùÅ RoomPolicy Service ΓÇ║ getPoliciesByType ΓÇ║ should return active policies by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getPoliciesByType ΓÇ║ should return inactive policies when specified

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ calculateRefund ΓÇ║ should throw error for invalid policy type

    expect(received).toThrow(expected)

    Expected substring: "Invalid cancellation policy"
    Received message:   "400"

        [0m [90m 110 |[39m   calculateRefund(cancellationPolicy[33m,[39m bookingStartTime[33m,[39m cancellationTime[33m,[39m bookingAmount) {
         [90m 111 |[39m     [36mif[39m ([33m![39mcancellationPolicy [33m||[39m cancellationPolicy[33m.[39mtype [33m!==[39m 
[32m'CANCELLATION'[39m) {
        [31m[1m>[22m[39m[90m 112 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid cancellation 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 113 |[39m     }
         [90m 114 |[39m
         [90m 115 |[39m     [36mconst[39m hoursBeforeBooking [33m=[39m [33mMath[39m[33m.[39mfloor([0m

      at RoomPolicyService.calculateRefund (src/services/roomPolicy.service.js:112:13)
      at calculateRefund (src/tests/unit/services/roomPolicy.service.test.js:261:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:266:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:266:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateRefund ΓÇ║ should throw error for null policy

    expect(received).toThrow(expected)

    Expected substring: "Invalid cancellation policy"
    Received message:   "400"

        [0m [90m 110 |[39m   calculateRefund(cancellationPolicy[33m,[39m bookingStartTime[33m,[39m cancellationTime[33m,[39m bookingAmount) {
         [90m 111 |[39m     [36mif[39m ([33m![39mcancellationPolicy [33m||[39m cancellationPolicy[33m.[39mtype [33m!==[39m 
[32m'CANCELLATION'[39m) {
        [31m[1m>[22m[39m[90m 112 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid cancellation 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 113 |[39m     }
         [90m 114 |[39m
         [90m 115 |[39m     [36mconst[39m hoursBeforeBooking [33m=[39m [33mMath[39m[33m.[39mfloor([0m

      at RoomPolicyService.calculateRefund (src/services/roomPolicy.service.js:112:13)
      at calculateRefund (src/tests/unit/services/roomPolicy.service.test.js:270:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:275:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:275:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateNoShowCharge ΓÇ║ should throw error for invalid policy type

    expect(received).toThrow(expected)

    Expected substring: "Invalid no-show policy"
    Received message:   "400"

        [0m [90m 154 |[39m   calculateNoShowCharge(noShowPolicy[33m,[39m bookingStartTime[33m,[39m checkInTime[33m,[39m bookingAmount[33m,[39m 
previousNoShowCount [33m=[39m [35m0[39m) {
         [90m 155 |[39m     [36mif[39m ([33m![39mnoShowPolicy [33m||[39m noShowPolicy[33m.[39mtype [33m!==[39m [32m'NO_SHOW'[39m) {
        [31m[1m>[22m[39m[90m 156 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid no-show 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 157 |[39m     }
         [90m 158 |[39m
         [90m 159 |[39m     [36mconst[39m rules [33m=[39m noShowPolicy[33m.[39mnoShowRules[33m;[39m[0m

      at RoomPolicyService.calculateNoShowCharge (src/services/roomPolicy.service.js:156:13)
      at calculateNoShowCharge (src/tests/unit/services/roomPolicy.service.test.js:435:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:440:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:440:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateNoShowCharge ΓÇ║ should throw error for unknown charge type

    expect(received).toThrow(expected)

    Expected substring: "Unknown charge type"
    Received message:   "400"

        [0m [90m 231 |[39m
         [90m 232 |[39m       [36mdefault[39m[33m:[39m
        [31m[1m>[22m[39m[90m 233 |[39m         [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Unknown charge 
type"[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 234 |[39m     }
         [90m 235 |[39m   }
         [90m 236 |[39m[0m

      at RoomPolicyService.calculateNoShowCharge (src/services/roomPolicy.service.js:233:15)
      at calculateNoShowCharge (src/tests/unit/services/roomPolicy.service.test.js:451:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:456:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:456:10)

  ΓùÅ RoomPolicy Service ΓÇ║ updatePolicy ΓÇ║ should update policy

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ updatePolicy ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "400"

        [0m [90m 252 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 253 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 254 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to update 
policy: ${error.message}`[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 255 |[39m     }
         [90m 256 |[39m   }
         [90m 257 |[39m[0m

      at RoomPolicyService.updatePolicy (src/services/roomPolicy.service.js:254:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:481:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:483:10)

  ΓùÅ RoomPolicy Service ΓÇ║ deletePolicy ΓÇ║ should soft delete policy by setting isActive to false

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ deletePolicy ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "500"

        [0m [90m 273 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 274 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 275 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m500[39m[33m,[39m [32m`Failed to delete 
policy: ${error.message}`[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 276 |[39m     }
         [90m 277 |[39m   }
         [90m 278 |[39m[0m

      at RoomPolicyService.deletePolicy (src/services/roomPolicy.service.js:275:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:509:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:511:10)

  ΓùÅ RoomPolicy Service ΓÇ║ getAllActivePolicies ΓÇ║ should return active policies grouped by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllActivePolicies ΓÇ║ should not include inactive policies

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

FAIL src/tests/unit/services/service.service.test.js
  Service Service
    getAllServices
      ΓêÜ should return all services with pagination (187 ms)
      ΓêÜ should paginate services correctly (23 ms)
      ΓêÜ should search by name (48 ms)
      ΓêÜ should search by description (15 ms)
      ΓêÜ should filter by status (17 ms)
      ΓêÜ should combine search and status filter (18 ms)
      ΓêÜ should handle invalid page number (13 ms)
      ΓêÜ should limit max results (17 ms)
      ΓêÜ should sort by createdAt descending (13 ms)
    getAvailableServices
      ├ù should return only active and available services (12 ms)
      ΓêÜ should return limited fields (14 ms)
      ΓêÜ should sort by name ascending (12 ms)
    getAvailableServiceDetail
      ΓêÜ should return service detail (9 ms)
      ΓêÜ should throw error for inactive service (15 ms)
      ├ù should throw error for unavailable service (9 ms)
      ΓêÜ should throw error for non-existent service (7 ms)
    getServiceById
      ΓêÜ should return service by id (9 ms)
      ΓêÜ should throw error for non-existent service (7 ms)
    createService
      ΓêÜ should create service with valid data (6 ms)
      ΓêÜ should trim whitespace from name and description (7 ms)
      ΓêÜ should create service without description (5 ms)
      ΓêÜ should throw error for duplicate name (8 ms)
    updateService
      ΓêÜ should update service name (13 ms)
      ΓêÜ should update service description (9 ms)
      ΓêÜ should update service price (9 ms)
      ΓêÜ should update service status (10 ms)
      ΓêÜ should throw error for non-existent service (10 ms)
      ΓêÜ should throw error for duplicate name (18 ms)
      ΓêÜ should trim whitespace from name and description (14 ms)
    deleteService
      ΓêÜ should delete service not in use (18 ms)
      ΓêÜ should throw error for non-existent service (6 ms)
      ├ù should throw error if service is in use in bookings (8 ms)
    Service Status Constants
      ΓêÜ should have ACTIVE status (4 ms)
      ΓêÜ should have INACTIVE status (2 ms)

  ΓùÅ Service Service ΓÇ║ getAvailableServices ΓÇ║ should return only active and available services

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [{"_id": "6939ca3ca0d84a59053fef8e", "description": "", "name": "Active Service", "pricePerUse": 100000}, {"_id": 
"6939ca3ca0d84a59053fef90", "description": "", "name": "Active Unavailable", "pricePerUse": 300000}]

    [0m [90m 115 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getAvailableServices()[33m;[39m
     [90m 116 |[39m
    [31m[1m>[22m[39m[90m 117 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 118 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Active Service'[39m)[33m;[39m
     [90m 119 |[39m     })[33m;[39m
     [90m 120 |[39m[0m

      at Object.toHaveLength (src/tests/unit/services/service.service.test.js:117:22)

  ΓùÅ Service Service ΓÇ║ getAvailableServiceDetail ΓÇ║ should throw error for unavailable service

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"_id": "6939ca3ca0d84a59053fefb5", "description": "", "name": "Unavailable", "pricePerUse": 100000}

    [0m [90m 181 |[39m       })[33m;[39m
     [90m 182 |[39m
    [31m[1m>[22m[39m[90m 183 |[39m       [36mawait[39m expect(getAvailableServiceDetail(service[33m.[39m_id))
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 184 |[39m         [33m.[39mrejects
     [90m 185 |[39m         [33m.[39mtoThrow([33mNotFoundError[39m)[33m;[39m
     [90m 186 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.expect (src/tests/unit/services/service.service.test.js:183:13)

  ΓùÅ Service Service ΓÇ║ deleteService ΓÇ║ should throw error if service is in use in bookings

    ValidationError: BookingDetail validation failed: pricePerUnit: Path `pricePerUnit` is required., detailType: Path `detailType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [34mΓä╣[0m [2025-12-10T19:30:04.960Z] INFO: PayOS client initialized successfully {"clientId":"6bc0bfcb...","environment":"test"}

      at Object.log [as info] (src/utils/logger.js:21:15)

(node:31248) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL src/tests/unit/services/payment.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/payment.service.js' does not provide an export named 'getPaymentById'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/unit/services/equipment.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 22 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 23 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 24 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 25 |[39m
     [90m 26 |[39m describe([32m'Equipment Service'[39m[33m,[39m () [33m=>[39m {
     [90m 27 |[39m   [90m// #region Get Equipment Tests[39m[0m

      at require (src/tests/unit/services/equipment.service.test.js:24:5)
      at _getJestObj (src/tests/unit/services/equipment.service.test.js:22:1)

  console.log
    [32mΓ£ô[0m [2025-12-10T19:30:06.619Z] SUCCESS: Verification email sent to test@example.com

      at Object.log [as success] (src/utils/logger.js:27:15)

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [34mΓä╣[0m [2025-12-10T19:30:07.064Z] INFO: PayOS client initialized successfully {"clientId":"6bc0bfcb...","environment":"test"}

      at Object.log [as info] (src/utils/logger.js:21:15)

FAIL src/tests/unit/services/auth.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 36 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 37 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 38 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 39 |[39m
     [90m 40 |[39m describe([32m'Auth Service'[39m[33m,[39m () [33m=>[39m {
     [90m 41 |[39m   [90m// #region Helper Functions Tests[39m[0m

      at require (src/tests/unit/services/auth.service.test.js:38:5)
      at _getJestObj (src/tests/unit/services/auth.service.test.js:31:1)

FAIL src/tests/unit/services/booking.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 34 |[39m   acquireLock[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([32m'mock-lock-token'[39m)[33m,[39m
     [90m 35 |[39m   releaseLock[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 36 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 37 |[39m
     [90m 38 |[39m describe([32m'Booking Service'[39m[33m,[39m () [33m=>[39m {
     [90m 39 |[39m   [36mlet[39m testUser[33m;[39m[0m

      at require (src/tests/unit/services/booking.service.test.js:36:5)
      at _getJestObj (src/tests/unit/services/booking.service.test.js:21:1)

FAIL src/tests/unit/middlewares/auth.test.js (8.428 s)
  Auth Middleware
    protect
      ├ù should allow access with valid token (1141 ms)
      ├ù should reject request without token (543 ms)
      ├ù should reject request with invalid token (36 ms)
      ├ù should reject request with expired token (276 ms)
      ├ù should reject request for non-existent user (178 ms)
      ├ù should reject request for inactive user (665 ms)
      ├ù should handle malformed authorization header (110 ms)
    optionalProtect
      ├ù should attach user if valid token provided (262 ms)
      ├ù should continue without user if no token (94 ms)
      ├ù should continue without user if invalid token (78 ms)
    authorize
      ├ù should allow access for authorized role (93 ms)
      ├ù should allow access when role is in array (97 ms)
      ├ù should reject access for unauthorized role (108 ms)
      ├ù should work with single role (75 ms)
      ├ù should reject when user role not in allowed roles (304 ms)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should allow access with valid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:26:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request without token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:38:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request with invalid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:55:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request with expired token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:78:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request for non-existent user

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:100:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request for inactive user

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:123:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should handle malformed authorization header

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:139:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should attach user if valid token provided

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:166:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should continue without user if no token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:178:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should continue without user if invalid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:191:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should allow access for authorized role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:207:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should allow access when role is in array

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:219:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should reject access for unauthorized role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:231:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should work with single role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:248:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should reject when user role not in allowed roles

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:260:19)

FAIL src/tests/unit/services/schedule.service.test.js (8.539 s)
  Schedule Service
    createSchedule
      ΓêÜ should create schedule with valid data (933 ms)
      ΓêÜ should throw error for missing required fields (387 ms)
      ΓêÜ should throw error for invalid start time (452 ms)
      ΓêÜ should throw error for invalid end time (54 ms)
      ΓêÜ should throw error if end time before start time (102 ms)
      ΓêÜ should throw error for start time in the past (58 ms)
      ΓêÜ should throw error for duration less than 1 hour (39 ms)
      ΓêÜ should throw error for overlapping schedules (56 ms)
      ΓêÜ should throw error for schedules too close (less than 30 min gap) (38 ms)
      ΓêÜ should allow schedules with 30+ minute gap (46 ms)
    getScheduleById
      ΓêÜ should return schedule by id (227 ms)
      ΓêÜ should throw error for non-existent schedule (224 ms)
      ΓêÜ should throw error for missing id (254 ms)
    getSchedules
      ΓêÜ should return paginated schedules (356 ms)
      ΓêÜ should filter by studioId (153 ms)
      ΓêÜ should filter by status (129 ms)
      ΓêÜ should handle pagination (123 ms)
      ΓêÜ should sort by startTime ascending (88 ms)
    updateSchedule
      ΓêÜ should update schedule times (108 ms)
      ΓêÜ should throw error for non-existent schedule (116 ms)
    markScheduleBooked
      ΓêÜ should mark schedule as booked (97 ms)
      ΓêÜ should throw error for non-existent schedule (319 ms)
    freeSchedule
      ΓêÜ should free booked schedule (126 ms)
    deleteSchedule
      ├ù should delete available schedule (100 ms)
      ΓêÜ should throw error for non-existent schedule (108 ms)

  ΓùÅ Schedule Service ΓÇ║ deleteSchedule ΓÇ║ should delete available schedule

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 361 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteSchedule(schedule[33m.[39m_id)[33m;[39m
     [90m 362 |[39m
    [31m[1m>[22m[39m[90m 363 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 364 |[39m
     [90m 365 |[39m       [36mconst[39m deleted [33m=[39m [36mawait[39m [33mSchedule[39m[33m.[39mfindById(schedule[33m.[39m_id)[33m;[39m
     [90m 366 |[39m       expect(deleted)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.toBeDefined (src/tests/unit/services/schedule.service.test.js:363:30)

  console.log
    [32mΓ£ô[0m [2025-12-10T19:30:10.410Z] SUCCESS: Password reset email sent to test@example.com

      at Object.log [as success] (src/utils/logger.js:27:15)

  console.log
    [32mΓ£ô[0m [2025-12-10T19:30:12.471Z] SUCCESS: Booking confirmation email sent to test@example.com

      at Object.log [as success] (src/utils/logger.js:27:15)

  console.error
    [31mΓ£û[0m [2025-12-10T19:30:12.495Z] ERROR: Failed to send staff credentials email to staff@example.com {"error":"Cannot read properties of undefined (reading 'toUpperCase')","stack":"TypeError: Cannot read properties of undefined (reading 'toUpperCase')\n    at toUpperCase (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\src\\services\\email.service.js:154:176)\n    at createStaffCredentialsTemplate (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\src\\services\\email.service.js:279:13)\n    at Object.sendStaffCredentialsEmail (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\src\\tests\\unit\\services\\email.service.test.js:88:22)\n    at Promise.finally.completed (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1497:10)\n    at _callCircusTest (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1007:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:947:3)\n    at D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at run (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1918:21)\n    at jestAdapter (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-circus\\build\\runner.js:101:19)\n    at runTestInternal (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-runner\\build\\testWorker.js:275:16)\n    at runTest (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-runner\\build\\testWorker.js:343:7)\n    at Object.worker (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\jest-runner\\build\\testWorker.js:497:12)"}

    [0m [90m 35 |[39m   error[33m:[39m (message[33m,[39m error [33m=[39m [36mnull[39m[33m,[39m meta [33m=[39m {}) [33m=>[39m {
     [90m 36 |[39m     [36mconst[39m errorMeta [33m=[39m error [33m?[39m { [33m...[39mmeta[33m,[39m error[33m:[39m error[33m.[39mmessage[33m,[39m stack[33m:[39m error[33m.[39mstack } [33m:[39m meta[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     console[33m.[39merror([32m`${colors.red}Γ£û${colors.reset} ${formatMessage('ERROR', message, errorMeta)}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 38 |[39m   }[33m,[39m
     [90m 39 |[39m
     [90m 40 |[39m   debug[33m:[39m (message[33m,[39m meta [33m=[39m {}) [33m=>[39m {[0m

      at Object.error (src/utils/logger.js:37:13)
      at error (src/services/email.service.js:283:12)
      at Object.sendStaffCredentialsEmail (src/tests/unit/services/email.service.test.js:88:22)

  console.log
    [32mΓ£ô[0m [2025-12-10T19:30:12.816Z] SUCCESS: Staff credentials email sent to test@example.com

      at Object.log [as success] (src/utils/logger.js:27:15)

FAIL src/tests/integration/auth.api.test.js (12.837 s)
  Auth API Integration Tests
    POST /api/auth/register
      ├ù should register a new customer (1211 ms)
      ├ù should reject registration with invalid email (203 ms)
      ├ù should reject registration with weak password (138 ms)
      ├ù should reject duplicate username (556 ms)
      ├ù should reject duplicate email (260 ms)
    POST /api/auth/login
      ├ù should login with valid credentials (249 ms)
      ├ù should reject login with invalid password (231 ms)
      ├ù should reject login with non-existent email (413 ms)
      ΓêÜ should reject login with missing fields (277 ms)
    POST /api/auth/verify-email
      ├ù should verify email with valid code (209 ms)
      ├ù should reject invalid verification code (158 ms)
      ├ù should reject expired verification code (359 ms)
    POST /api/auth/forgot-password
      ΓêÜ should send reset email for existing user (3064 ms)
      ΓêÜ should handle non-existent email (56 ms)
    POST /api/auth/change-password
      ΓêÜ should reject without authentication (38 ms)
    POST /api/auth/refresh-token
      ├ù should reject without refresh token (35 ms)
      ├ù should reject invalid refresh token (44 ms)
    POST /api/auth/logout
      ├ù should accept logout request (44 ms)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should register a new customer

    expected "Content-Type" matching /json/, got "text/html; charset=utf-8"

    [0m [90m 54 |[39m         [33m.[39mpost([32m'/api/auth/register'[39m)
     [90m 55 |[39m         [33m.[39msend(userData)
    [31m[1m>[22m[39m[90m 56 |[39m         [33m.[39mexpect([32m'Content-Type'[39m[33m,[39m [35m/json/[39m)[33m;[39m
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 57 |[39m
     [90m 58 |[39m       [90m// Could be 201 (created) or could fail if validation middleware not properly set up[39m
     [90m 59 |[39m       [90m// Adjust based on actual API behavior[39m[0m

      at Object.expect (src/tests/integration/auth.api.test.js:56:10)
      ----
      at Test._assertHeader (node_modules/supertest/lib/test.js:289:16)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject registration with invalid email

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 422]

    [0m [90m 73 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m       expect([[35m400[39m[33m,[39m [35m422[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 76 |[39m     })[33m;[39m
     [90m 77 |[39m
     [90m 78 |[39m     it([32m'should reject registration with weak password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:75:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject registration with weak password

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 422]

    [0m [90m 88 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 89 |[39m
    [31m[1m>[22m[39m[90m 90 |[39m       expect([[35m400[39m[33m,[39m [35m422[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m
     [90m 93 |[39m     it([32m'should reject duplicate username'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:90:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject duplicate username

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 409]

    [0m [90m 105 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m       expect([[35m400[39m[33m,[39m [35m409[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 108 |[39m     })[33m;[39m
     [90m 109 |[39m
     [90m 110 |[39m     it([32m'should reject duplicate email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:107:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject duplicate email

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 409]

    [0m [90m 122 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 123 |[39m
    [31m[1m>[22m[39m[90m 124 |[39m       expect([[35m400[39m[33m,[39m [35m409[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 125 |[39m     })[33m;[39m
     [90m 126 |[39m   })[33m;[39m
     [90m 127 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:124:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should login with valid credentials

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [200, 401]

    [0m [90m 151 |[39m
     [90m 152 |[39m       [90m// Could be 200 (success) or 401 (if user not verified or password hash issue)[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 154 |[39m     })[33m;[39m
     [90m 155 |[39m
     [90m 156 |[39m     it([32m'should reject login with invalid password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:153:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with invalid password

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

    [0m [90m 162 |[39m         })[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m
     [90m 167 |[39m     it([32m'should reject login with non-existent email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/tests/integration/auth.api.test.js:164:31)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with non-existent email

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [401, 404]

    [0m [90m 173 |[39m         })[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       expect([[35m401[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 176 |[39m     })[33m;[39m
     [90m 177 |[39m
     [90m 178 |[39m     it([32m'should reject login with missing fields'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:175:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should verify email with valid code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 205 |[39m         })[33m;[39m
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m
     [90m 210 |[39m     it([32m'should reject invalid verification code'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:207:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should reject invalid verification code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 223 |[39m         })[33m;[39m
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m     })[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m     it([32m'should reject expired verification code'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:225:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should reject expired verification code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 241 |[39m         })[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 244 |[39m     })[33m;[39m
     [90m 245 |[39m   })[33m;[39m
     [90m 246 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:243:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/refresh-token ΓÇ║ should reject without refresh token

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 294 |[39m         [33m.[39msend({})[33m;[39m
     [90m 295 |[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should reject invalid refresh token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:296:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/refresh-token ΓÇ║ should reject invalid refresh token

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 302 |[39m         [33m.[39msend({ refreshToken[33m:[39m [32m'invalid-token'[39m })[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:304:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/logout ΓÇ║ should accept logout request

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 204, 400, 401]

    [0m [90m 315 |[39m
     [90m 316 |[39m       [90m// Logout typically succeeds even with invalid token[39m
    [31m[1m>[22m[39m[90m 317 |[39m       expect([[35m200[39m[33m,[39m [35m204[39m[33m,[39m [35m400[39m[33m,[39m 
[35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 318 |[39m     })[33m;[39m
     [90m 319 |[39m   })[33m;[39m
     [90m 320 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:317:36)

PASS src/tests/integration/studio.api.test.js (12.878 s)
  Studio API Integration Tests
    GET /api/studios
      ΓêÜ should return list of studios (2016 ms)
      ΓêÜ should support pagination (409 ms)
      ΓêÜ should support search (371 ms)
      ΓêÜ should filter by status (549 ms)
    GET /api/studios/:id
      ΓêÜ should return studio by id (424 ms)
      ΓêÜ should return 404 for non-existent studio (480 ms)
      ΓêÜ should return 400 for invalid id format (276 ms)
    POST /api/studios
      ΓêÜ should create studio with admin token (234 ms)
      ΓêÜ should reject create without auth (231 ms)
      ΓêÜ should reject create with customer token (204 ms)
      ΓêÜ should reject create with missing required fields (416 ms)
    PUT /api/studios/:id
      ΓêÜ should update studio with admin token (211 ms)
      ΓêÜ should reject update without auth (204 ms)
      ΓêÜ should reject update with customer token (253 ms)
    DELETE /api/studios/:id
      ΓêÜ should delete studio with admin token (377 ms)
      ΓêÜ should reject delete without auth (211 ms)
      ΓêÜ should reject delete with customer token (212 ms)
    GET /api/studios/active
      ΓêÜ should return only active studios (238 ms)
    GET /api/studios/:id/schedule
      ΓêÜ should return studio schedule (277 ms)

  console.log
    [32mΓ£ô[0m [2025-12-10T19:30:14.542Z] SUCCESS: No-show email sent to customer@example.com

      at Object.log [as success] (src/utils/logger.js:27:15)

  console.error
    [31mΓ£û[0m [2025-12-10T19:30:15.354Z] ERROR: Failed to send email to [object Object] {"error":"No recipients defined","stack":"Error: No recipients defined\n    at SMTPConnection._formatError (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:809:19)\n    at SMTPConnection._setEnvelope (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:1047:34)\n    at SMTPConnection.send (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:631:14)\n    at sendMessage (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-transport\\index.js:228:28)\n    at D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-transport\\index.js:286:25\n    at SMTPConnection._actionAUTHComplete (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:1609:9)\n    at SMTPConnection.<anonymous> (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:556:26)\n    at SMTPConnection._processResponse (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:993:20)\n    at SMTPConnection._onData (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:774:14)\n    at TLSSocket.SMTPConnection._onSocketData (D:\\SFR_BE\\StudioForRent_FA25SE219_BE\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:195:44)\n    at TLSSocket.emit (node:events:518:28)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at TLSSocket.Readable.push (node:internal/streams/readable:392:5)\n    at TLSWrap.onStreamRead (node:internal/stream_base_commons:189:23)\n    at TLSWrap.callbackTrampoline (node:internal/async_hooks:130:17)"}

    [0m [90m 35 |[39m   error[33m:[39m (message[33m,[39m error [33m=[39m [36mnull[39m[33m,[39m meta [33m=[39m {}) [33m=>[39m {
     [90m 36 |[39m     [36mconst[39m errorMeta [33m=[39m error [33m?[39m { [33m...[39mmeta[33m,[39m error[33m:[39m error[33m.[39mmessage[33m,[39m stack[33m:[39m error[33m.[39mstack } [33m:[39m meta[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     console[33m.[39merror([32m`${colors.red}Γ£û${colors.reset} ${formatMessage('ERROR', message, errorMeta)}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 38 |[39m   }[33m,[39m
     [90m 39 |[39m
     [90m 40 |[39m   debug[33m:[39m (message[33m,[39m meta [33m=[39m {}) [33m=>[39m {[0m

      at Object.error (src/utils/logger.js:37:13)
      at error (src/services/email.service.js:332:12)
      at Object.<anonymous> (src/tests/unit/services/email.service.test.js:139:9)

PASS src/tests/unit/services/email.service.test.js (14.709 s)
  Email Service
    sendVerificationEmail
      ΓêÜ should be a function (6 ms)
      ΓêÜ should return promise (2249 ms)
    sendPasswordResetEmail
      ΓêÜ should be a function (2 ms)
      ΓêÜ should return promise (3781 ms)
    sendBookingConfirmationEmail
      ΓêÜ should be a function (1 ms)
      ΓêÜ should return promise (2059 ms)
    sendStaffCredentialsEmail
      ΓêÜ should be a function
      ΓêÜ should return promise (28 ms)
    sendNoShowEmail
      ΓêÜ should be a function (1 ms)
      ΓêÜ should return promise (2040 ms)
    sendEmail
      ΓêÜ should be a function (1 ms)
      ΓêÜ should return promise (812 ms)

FAIL src/tests/integration/booking.api.test.js (16.148 s)
  Booking API Integration Tests
    GET /api/bookings
      ΓêÜ should return bookings for admin (1514 ms)
      ΓêÜ should return bookings for staff (751 ms)
      ΓêÜ should return customer own bookings (549 ms)
      ΓêÜ should reject without authentication (554 ms)
      ΓêÜ should support pagination (343 ms)
      ΓêÜ should filter by status (320 ms)
    GET /api/bookings/:id
      ΓêÜ should return booking by id for owner (593 ms)
      ΓêÜ should return booking by id for admin (312 ms)
      ΓêÜ should return 404 for non-existent booking (335 ms)
      ΓêÜ should reject without authentication (483 ms)
    POST /api/bookings
      ΓêÜ should create booking for customer (324 ms)
      ΓêÜ should reject booking without authentication (292 ms)
      ΓêÜ should reject booking with missing studioId (564 ms)
      ΓêÜ should reject booking with missing scheduleIds (348 ms)
    PUT /api/bookings/:id/status
      ΓêÜ should update booking status by staff (266 ms)
      ΓêÜ should update booking status by admin (253 ms)
      ├ù should reject status update by customer (424 ms)
      ΓêÜ should reject without authentication (250 ms)
    PUT /api/bookings/:id/cancel
      ΓêÜ should allow customer to cancel own booking (279 ms)
      ΓêÜ should allow admin to cancel any booking (307 ms)
      ΓêÜ should reject cancel without authentication (421 ms)
    GET /api/bookings/my-bookings
      ├ù should return customer own bookings (264 ms)
      ΓêÜ should reject without authentication (252 ms)

  ΓùÅ Booking API Integration Tests ΓÇ║ PUT /api/bookings/:id/status ΓÇ║ should reject status update by customer

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [401, 403]

    [0m [90m 298 |[39m         [33m.[39msend({ status[33m:[39m [33mBOOKING_STATUS[39m[33m.[39m[33mCONFIRMED[39m })[33m;[39m
     [90m 299 |[39m
    [31m[1m>[22m[39m[90m 300 |[39m       expect([[35m401[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 301 |[39m     })[33m;[39m
     [90m 302 |[39m
     [90m 303 |[39m     it([32m'should reject without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/booking.api.test.js:300:26)

  ΓùÅ Booking API Integration Tests ΓÇ║ GET /api/bookings/my-bookings ΓÇ║ should return customer own bookings

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [200, 401, 403]

    [0m [90m 366 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${customerToken}`[39m)[33m;[39m
     [90m 367 |[39m
    [31m[1m>[22m[39m[90m 368 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m 
[35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 369 |[39m     })[33m;[39m
     [90m 370 |[39m
     [90m 371 |[39m     it([32m'should reject without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/booking.api.test.js:368:31)

FAIL src/tests/unit/services/report.service.test.js (21.387 s)
  Report Service
    createReport
      ├ù should create report with valid data for booking (1747 ms)
      ΓêÜ should create report for review (1135 ms)
      ΓêÜ should throw error if reporterId is missing (562 ms)
      ΓêÜ should throw error if targetType is missing and no bookingId (685 ms)
      ΓêÜ should throw error if targetId is missing (531 ms)
      ΓêÜ should throw error if issueType is missing (528 ms)
      ΓêÜ should throw error if description is missing (330 ms)
      ΓêÜ should throw error for invalid issueType (307 ms)
      ΓêÜ should throw error for invalid priority (287 ms)
      ΓêÜ should throw error for invalid status (522 ms)
      ΓêÜ should throw error for negative compensationAmount (303 ms)
      ├ù should throw error if target does not exist (376 ms)
      ├ù should use bookingId as targetId for backward compatibility (468 ms)
    getReports
      ├ù should return all reports (284 ms)
      ├ù should filter by status (365 ms)
      ├ù should filter by issueType (507 ms)
      ├ù should filter by priority (298 ms)
      ├ù should throw error for invalid status filter (249 ms)
      ├ù should throw error for invalid issueType filter (244 ms)
      ├ù should throw error for invalid priority filter (420 ms)
    getReportById
      ├ù should return report by id for admin (258 ms)
      ├ù should return report by id for staff (285 ms)
      ├ù should return report by id for owner (456 ms)
      ├ù should throw error if id is missing (258 ms)
      ├ù should throw error if report not found (249 ms)
      ├ù should throw error if user not authorized (247 ms)
    updateReport
      ├ù should update report status (419 ms)
      ├ù should update report priority (269 ms)
      ├ù should update compensationAmount (239 ms)
      ├ù should update description (239 ms)
      ├ù should throw error if id is missing (392 ms)
      ├ù should throw error if update data is empty (457 ms)
      ├ù should throw error for invalid status (303 ms)
      ├ù should throw error for invalid priority (604 ms)
      ├ù should throw error for negative compensationAmount (239 ms)
      ├ù should throw error for empty description (240 ms)
      ├ù should throw error if report not found (251 ms)
    deleteReport
      ├ù should delete report (373 ms)
      ├ù should throw error if id is missing (244 ms)
      ├ù should throw error if report not found (242 ms)
    Report Constants
      ΓêÜ should have all report target types (239 ms)
      ├ù should have all report statuses (273 ms)
      ├ù should have report issue types (354 ms)

  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should create report with valid data for booking

    Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc

    [0m [90m 29 |[39m
     [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 32 |[39m     }
     [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
     [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:58:28)

  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should throw error if target does not exist

    expect(received).rejects.toThrow(expected)

    Expected constructor: NotFoundError
    Received constructor: ValidationError

    Received message: "Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc"

        [0m [90m 29 |[39m
         [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
        [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 32 |[39m     }
         [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
         [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:223:20)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/report.service.test.js:225:10)

  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should use bookingId as targetId for backward compatibility

    Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc

    [0m [90m 29 |[39m
     [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 32 |[39m     }
     [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
     [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:236:28)

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should return all reports

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by issueType

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid status filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid issueType filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid priority filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for admin

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for staff

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for owner

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if user not authorized

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update report status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update report priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update compensationAmount

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update description

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if update data is empty

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for invalid status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for invalid priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for negative compensationAmount

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for empty description

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should delete report

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ Report Constants ΓÇ║ should have all report statuses

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 522 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mIN_PROGRESS[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m 523 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mRESOLVED[39m)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 524 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mREJECTED[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 525 |[39m     })[33m;[39m
     [90m 526 |[39m
     [90m 527 |[39m     it([32m'should have report issue types'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeDefined (src/tests/unit/services/report.service.test.js:524:38)

  ΓùÅ Report Service ΓÇ║ Report Constants ΓÇ║ should have report issue types

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 526 |[39m
     [90m 527 |[39m     it([32m'should have report issue types'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 528 |[39m       expect([33mREPORT_ISSUE_TYPE[39m[33m.[39m[33mEQUIPMENT_DAMAGE[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 529 |[39m       expect([33mREPORT_ISSUE_TYPE[39m[33m.[39m[33mOTHER[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m 530 |[39m     })[33m;[39m
     [90m 531 |[39m   })[33m;[39m[0m

      at Object.toBeDefined (src/tests/unit/services/report.service.test.js:528:50)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running 
with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
-------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------
File                           | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                   
-------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------
All files                      |   15.69 |     8.06 |    18.4 |   15.79 |                                                                                                                                                     
 controllers                   |    5.63 |        2 |    4.39 |    5.62 |                                                                                                                                                     
  admin.controller.js          |       0 |        0 |       0 |       0 | 14-104                                                                                                                                              
  analytics.controller.js      |       0 |      100 |       0 |       0 | 13-18                                                                                                                                               
  auth.controller.js           |   23.75 |     6.97 |   18.18 |   23.75 | 21-30,38-47,55-64,73-83,91-101,109-119,130-131,137,144,153-168,186-202,214-215                                                                      
  booking.controller.js        |   47.72 |    43.75 |   33.33 |   46.51 | 24-26,55-56,60-62,66-67,71-78,82-86,90-94                                                                                                           
  bookingDetail.controller.js  |    4.54 |        0 |       0 |    4.54 | 7-43                                                                                                                                                
  comment.controller.js        |       0 |        0 |       0 |       0 | 16-128                                                                                                                                              
  customer.controller.js       |       0 |        0 |       0 |       0 | 13-73                                                                                                                                               
  equipment.controller.js      |       0 |        0 |       0 |       0 | 20-179                                                                                                                                              
  message.controller.js        |       0 |        0 |       0 |       0 | 21-221                                                                                                                                              
  notification.controller.js   |       0 |        0 |       0 |       0 | 17-99                                                                                                                                               
  payment.controller.js        |       0 |        0 |       0 |       0 | 28-540                                                                                                                                              
  promotion.controller.js      |       0 |        0 |       0 |       0 | 12-169                                                                                                                                              
  report.controller.js         |       0 |        0 |       0 |       0 | 10-48                                                                                                                                               
  review.controller.js         |       0 |        0 |       0 |       0 | 17-126                                                                                                                                              
  roomPolicy.controller.js     |       0 |        0 |       0 |       0 | 14-168                                                                                                                                              
  schedule.controller.js       |       0 |      100 |       0 |       0 | 12-42                                                                                                                                               
  service.controller.js        |       0 |        0 |       0 |       0 | 21-148                                                                                                                                              
  setDesign.controller.js      |       0 |        0 |       0 |       0 | 37-697                                                                                                                                              
  staff.controller.js          |       0 |        0 |       0 |       0 | 7-53                                                                                                                                                
  studio.controller.js         |   21.95 |      5.4 |   14.28 |   22.31 | 27-38,76-94,104-117,127-129,137-139,147-149,159-161,170-266,301-316,328-337,349-369,381-390,406-414,426-435,447-452                                 
  upload.controller.js         |       0 |        0 |       0 |       0 | 14-326                                                                                                                                              
 middlewares                   |   24.02 |     8.83 |   33.33 |   24.01 |                                                                                                                                                     
  auth.js                      |   62.96 |       60 |      75 |   62.96 | 23,30,38,57-68                                                                                                                                      
  errorHandler.js              |       0 |        0 |       0 |       0 | 15-96                                                                                                                                               
  rateLimiter.js               |   71.42 |       20 |      60 |   71.42 | 22-27,49-54                                                                                                                                         
  redisRateLimiter.js          |    52.5 |    37.93 |      50 |   55.26 | 15-17,37-50,63-65,70-71                                                                                                                             
  socket.js                    |       0 |        0 |       0 |       0 | 18-97                                                                                                                                               
  upload.js                    |   21.42 |    10.71 |   26.66 |   21.81 | 14,19-24,30-48,56,63-74,87-110,122-127,132-153                                                                                                      
  validate.js                  |   17.73 |     5.45 |   33.33 |   17.42 | 13-48,63-69,76-96,100-150,154-180,184-204,211,225-257,261-287,296-328,335-355,362-376,418-423,435-470,477-517,528-633,640-741,748-763,779           
 models                        |       0 |        0 |       0 |       0 |                                                                                                                                                     
  index.js                     |       0 |        0 |       0 |       0 |                                                                                                                                                     
 models/Booking                |   52.38 |        0 |       0 |   52.38 |                                                                                                                                                     
  booking.model.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
  bookingDetail.model.js       |    37.5 |        0 |       0 |    37.5 | 76-92                                                                                                                                               
 models/Comment                |     100 |      100 |     100 |     100 |                                                                                                                                                     
  comment.model.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/CustomDesignRequest    |       0 |        0 |       0 |       0 |                                                                                                                                                     
  customDesignRequest.model.js |       0 |        0 |       0 |       0 | 13-191                                                                                                                                              
 models/Equipment              |   63.63 |        0 |       0 |   63.63 |                                                                                                                                                     
  equipment.model.js           |   63.63 |        0 |       0 |   63.63 | 70-76                                                                                                                                               
 models/Message                |     100 |      100 |     100 |     100 |                                                                                                                                                     
  message.model.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Notification           |     100 |      100 |     100 |     100 |                                                                                                                                                     
  notification.model.js        |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Payment                |     100 |      100 |     100 |     100 |                                                                                                                                                     
  payment.model.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Policy                 |      75 |       60 |      75 |      80 |                                                                                                                                                     
  roomPolicy.model.js          |      75 |       60 |      75 |      80 | 92-95                                                                                                                                               
 models/Promotion              |   16.21 |        0 |       0 |   18.18 |                                                                                                                                                     
  promotion.model.js           |   16.21 |        0 |       0 |   18.18 | 52-106,140-149,162-203                                                                                                                              
 models/RefreshToken           |      60 |        0 |       0 |      60 |                                                                                                                                                     
  refreshToken.model.js        |      60 |        0 |       0 |      60 | 44,48,53-54                                                                                                                                         
 models/Refund                 |   22.22 |        0 |       0 |   23.52 |                                                                                                                                                     
  refund.model.js              |   22.22 |        0 |       0 |   23.52 | 68-71,76,82-120                                                                                                                                     
 models/Report                 |     100 |      100 |     100 |     100 |                                                                                                                                                     
  report.model.js              |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Review                 |     100 |      100 |     100 |     100 |                                                                                                                                                     
  review.model.js              |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Schedule               |     100 |      100 |     100 |     100 |                                                                                                                                                     
  schedule.model.js            |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/Service                |     100 |      100 |     100 |     100 |                                                                                                                                                     
  service.model.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/SetDesign              |      75 |      100 |       0 |      75 |                                                                                                                                                     
  setDesign.model.js           |      75 |      100 |       0 |      75 | 48,84,89                                                                                                                                            
 models/Studio                 |     100 |      100 |     100 |     100 |                                                                                                                                                     
  studio.model.js              |     100 |      100 |     100 |     100 |                                                                                                                                                     
 models/User                   |     100 |      100 |     100 |     100 |                                                                                                                                                     
  customerProfile.model.js     |     100 |      100 |     100 |     100 |                                                                                                                                                     
  staffProfile.model.js        |     100 |      100 |     100 |     100 |                                                                                                                                                     
  user.model.js                |     100 |      100 |     100 |     100 |                                                                                                                                                     
 routes                        |    22.5 |      100 |   33.33 |    22.5 |                                                                                                                                                     
  admin.route.js               |       0 |      100 |     100 |       0 | 17-35                                                                                                                                               
  analytics.route.js           |       0 |      100 |     100 |       0 | 8-17                                                                                                                                                
  auth.route.js                |   94.11 |      100 |      50 |   94.11 | 37                                                                                                                                                  
  booking.route.js             |     100 |      100 |     100 |     100 |                                                                                                                                                     
  comment.route.js             |       0 |      100 |     100 |       0 | 13-34                                                                                                                                               
  customer.route.js            |       0 |      100 |     100 |       0 | 14-28                                                                                                                                               
  equipment.route.js           |       0 |      100 |     100 |       0 | 19-54                                                                                                                                               
  message.route.js             |       0 |      100 |     100 |       0 | 15-37                                                                                                                                               
  notification.route.js        |       0 |      100 |     100 |       0 | 16-54                                                                                                                                               
  payment.route.js             |       0 |      100 |       0 |       0 | 24-201                                                                                                                                              
  promotion.route.js           |       0 |      100 |     100 |       0 | 25-122                                                                                                                                              
  report.route.js              |       0 |      100 |     100 |       0 | 14-33                                                                                                                                               
  review.route.js              |       0 |      100 |     100 |       0 | 14-35                                                                                                                                               
  roomPolicy.route.js          |       0 |      100 |     100 |       0 | 7-25                                                                                                                                                
  schedule.route.js            |       0 |      100 |     100 |       0 | 14-31                                                                                                                                               
  service.route.js             |       0 |      100 |     100 |       0 | 17-37                                                                                                                                               
  setDesign.route.js           |       0 |      100 |     100 |       0 | 36-93                                                                                                                                               
  staff.route.js               |       0 |      100 |     100 |       0 | 13-24                                                                                                                                               
  studio.route.js              |     100 |      100 |     100 |     100 |                                                                                                                                                     
  upload.route.js              |       0 |      100 |     100 |       0 | 19-98                                                                                                                                               
 services                      |   12.82 |     8.56 |   14.63 |   12.87 |                                                                                                                                                     
  analytics.service.js         |       0 |        0 |       0 |       0 | 12-297                                                                                                                                              
  auth.service.js              |   24.65 |     8.21 |   31.57 |   22.85 | 17,25,62-73,77-83,93-94,103,109-149,153-191,195-212,218-248,253-332,337-350,360-422,430-459,487-488                                                 
  booking.service.js           |    8.73 |     6.41 |   11.53 |    8.83 | 28,34-247,258,325,382-622,626-705,714-735,746-808,820-885,890-981,990-1034,1059-1076,1081-1096,1101-1106,1111,1132-1136,1148                        
  bookingDetail.service.js     |    2.17 |        0 |       0 |    2.22 | 14-154,159-203                                                                                                                                      
  comment.service.js           |       0 |        0 |       0 |       0 | 12-238                                                                                                                                              
  email.service.js             |   82.14 |    35.71 |     100 |   82.14 | 223-224,243-244,263-264,305-306,326,330                                                                                                             
  equipment.service.js         |    8.05 |        0 |       0 |    8.27 | 16-26,36-71,86-95,102-110,117-130,139-198,208-278,289-304,316-330,339-368,377-406,414-457                                                           
  gettyImages.service.js       |       0 |        0 |       0 |       0 | 8-215                                                                                                                                               
  message.service.js           |       0 |        0 |       0 |       0 | 20-340                                                                                                                                              
  notification.service.js      |    8.33 |        0 |       0 |    8.77 | 28-43,59-65,76-111,122-155,166-181,191-205,214-224,234-247,257-337,351-368,377-384,394-413,424-459,466-477                                          
  payment.service.js           |    3.47 |        0 |       0 |    3.64 | 28-30,38-40,47-53,70-275,285-464,473-492,501-529,539-600,609-711,719-849,864-865,880-980,991-1072,1082-1177,1189-1225,1235-1261,1271-1308,1318-1453 
  promotion.service.js         |       0 |        0 |       0 |       0 | 16-376                                                                                                                                              
  refund.service.js            |       0 |        0 |       0 |       0 | 20-346                                                                                                                                              
  report.service.js            |   28.22 |    21.73 |      20 |   28.09 | 34,45-47,53-55,61,67-70,74-76,80,89-90,95-130,135-166,171-222,227-244                                                                               
  review.service.js            |       0 |        0 |       0 |       0 | 17-315                                                                                                                                              
  roomPolicy.service.js        |   58.97 |    50.94 |   63.63 |   58.97 | 16-55,70,85,95-98,125,252,273,283-294                                                                                                               
  schedule.service.js          |   78.57 |    65.92 |     100 |   79.72 | 47,66-77,92,112,124,140-143,150,154,174,180,186,194,200,215,224,231,242,252,259,262,281,289,296,304,312-315                                         
  service.service.js           |      95 |    84.09 |     100 |   94.64 | 124,156,176                                                                                                                                         
  setDesign.service.js         |       0 |        0 |       0 |       0 | 23-1769                                                                                                                                             
  studio.service.js            |    15.1 |     9.24 |   11.76 |   15.25 | 27-28,63,82-119,124-163,168-198,205-251,256-285,316,327-332,353-359,417-474,499-588,607-681,698-769,788-920,949-1019,1033-1131                      
  upload.service.js            |    8.64 |        0 |       0 |    9.45 | 8-59,65-122,128-138,144-158,164-176,188-190,206-208                                                                                                 
  user.service.js              |       0 |        0 |       0 |       0 | 10-307                                                                                                                                              
 utils                         |    56.5 |    32.71 |   67.27 |   57.87 |                                                                                                                                                     
  cache.js                     |   70.58 |    14.28 |     100 |   68.75 | 22-25,41-42                                                                                                                                         
  constants.js                 |     100 |      100 |     100 |     100 |                                                                                                                                                     
  errors.js                    |     100 |      100 |     100 |     100 |                                                                                                                                                     
  helpers.js                   |   83.01 |    73.68 |      85 |      84 | 175-184,194                                                                                                                                         
  logger.js                    |   81.25 |    47.05 |   66.66 |   81.25 | 32,41-42                                                                                                                                            
  redisHelpers.js              |   14.92 |        0 |       0 |   15.62 | 19-28,32-40,45-49,58-61,72-89,94-106,111-114,119-121                                                                                                
  redisLock.js                 |   15.38 |     8.69 |       0 |   17.14 | 20-38,46-63                                                                                                                                         
  validators.js                |     100 |      100 |     100 |     100 |                                                                                                                                                     
-------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------
Summary of all failing tests
FAIL src/tests/unit/services/user.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 23 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 24 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 25 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 26 |[39m
     [90m 27 |[39m describe([32m'User Service'[39m[33m,[39m () [33m=>[39m {
     [90m 28 |[39m   [90m// #region Customer Profile Tests[39m[0m

      at require (src/tests/unit/services/user.service.test.js:25:5)
      at _getJestObj (src/tests/unit/services/user.service.test.js:23:1)

FAIL src/tests/unit/services/studio.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 30 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 31 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 32 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 33 |[39m
     [90m 34 |[39m describe([32m'Studio Service'[39m[33m,[39m () [33m=>[39m {
     [90m 35 |[39m   [90m// #region Get Studios Tests[39m[0m

      at require (src/tests/unit/services/studio.service.test.js:32:5)
      at _getJestObj (src/tests/unit/services/studio.service.test.js:24:1)

FAIL src/tests/unit/services/review.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 24 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 25 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue({})[33m,[39m
    [31m[1m>[22m[39m[90m 26 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 27 |[39m
     [90m 28 |[39m describe([32m'Review Service'[39m[33m,[39m () [33m=>[39m {
     [90m 29 |[39m   [36mlet[39m customer[33m,[39m admin[33m,[39m studio[33m,[39m booking[33m;[39m[0m

      at require (src/tests/unit/services/review.service.test.js:26:5)
      at _getJestObj (src/tests/unit/services/review.service.test.js:24:1)

FAIL src/tests/unit/utils/errors.test.js
  ΓùÅ Custom Errors ΓÇ║ AppError ΓÇ║ should capture stack trace

    expect(received).toContain(expected) // indexOf

    Expected substring: "AppError"
    Received string:    "Error: Test error

    [0m [90m 29 |[39m
     [90m 30 |[39m     it([32m'should capture stack trace'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mAppError[39m([32m'Test error'[39m[33m,[39m 
[35m400[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 32 |[39m       expect(error[33m.[39mstack)[33m.[39mtoBeDefined()[33m;[39m
     [90m 33 |[39m       expect(error[33m.[39mstack)[33m.[39mtoContain([32m'AppError'[39m)[33m;[39m
     [90m 34 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/tests/unit/utils/errors.test.js:31:21)
      at Object.toContain (src/tests/unit/utils/errors.test.js:33:27)

  ΓùÅ Custom Errors ΓÇ║ NotFoundError ΓÇ║ should capture stack trace

    expect(received).toContain(expected) // indexOf

    Expected substring: "NotFoundError"
    Received string:    "Error: Studio not found

    [0m [90m 78 |[39m
     [90m 79 |[39m     it([32m'should capture stack trace'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 80 |[39m       [36mconst[39m error [33m=[39m [36mnew[39m [33mNotFoundError[39m([32m'Studio not 
found'[39m)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 81 |[39m       expect(error[33m.[39mstack)[33m.[39mtoContain([32m'NotFoundError'[39m)[33m;[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/tests/unit/utils/errors.test.js:80:21)
      at Object.toContain (src/tests/unit/utils/errors.test.js:81:27)

FAIL src/tests/unit/services/promotion.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/promotion.service.js' does not provide an export named 'togglePromotionActive'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

FAIL src/tests/unit/utils/validators.test.js
  ΓùÅ Validators ΓÇ║ isNotEmpty ΓÇ║ should return false for empty or whitespace-only strings

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: ""

    [0m [90m 125 |[39m
     [90m 126 |[39m     it([32m'should return false for empty or whitespace-only strings'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 127 |[39m       expect(isNotEmpty([32m''[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 128 |[39m       expect(isNotEmpty([32m'   '[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 129 |[39m       expect(isNotEmpty([32m'\t'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 130 |[39m       expect(isNotEmpty([32m'\n'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m[0m

      at Object.toBe (src/tests/unit/utils/validators.test.js:127:30)

  ΓùÅ Validators ΓÇ║ isNotEmpty ΓÇ║ should return false for null or undefined

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: null

    [0m [90m 132 |[39m
     [90m 133 |[39m     it([32m'should return false for null or undefined'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 134 |[39m       expect(isNotEmpty([36mnull[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 135 |[39m       expect(isNotEmpty(undefined))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 136 |[39m     })[33m;[39m
     [90m 137 |[39m   })[33m;[39m[0m

      at Object.toBe (src/tests/unit/utils/validators.test.js:134:32)

FAIL src/tests/unit/services/notification.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/notification.service.js' does not provide an export named 'createNotification'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

FAIL src/tests/unit/services/roomPolicy.service.test.js
  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should return all policies with pagination

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should filter by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should filter by isActive

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should search by name

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should search by description

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should handle pagination correctly

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllPolicies ΓÇ║ should handle invalid page number

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ createPolicy ΓÇ║ should create cancellation policy

    400

    [0m [90m 70 |[39m       [36mreturn[39m policy[33m;[39m
     [90m 71 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 72 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to create policy: 
${error.message}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 73 |[39m     }
     [90m 74 |[39m   }
     [90m 75 |[39m[0m

      at RoomPolicyService.createPolicy (src/services/roomPolicy.service.js:72:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:103:22)

  ΓùÅ RoomPolicy Service ΓÇ║ createPolicy ΓÇ║ should create no-show policy

    400

    [0m [90m 70 |[39m       [36mreturn[39m policy[33m;[39m
     [90m 71 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 72 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to create policy: 
${error.message}`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 73 |[39m     }
     [90m 74 |[39m   }
     [90m 75 |[39m[0m

      at RoomPolicyService.createPolicy (src/services/roomPolicy.service.js:72:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:120:22)

  ΓùÅ RoomPolicy Service ΓÇ║ getPolicyById ΓÇ║ should return policy by id

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getPolicyById ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "500"

        [0m [90m 85 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 86 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 87 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m500[39m[33m,[39m [32m`Failed to get policy: 
${error.message}`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 88 |[39m     }
         [90m 89 |[39m   }
         [90m 90 |[39m[0m

      at RoomPolicyService.getPolicyById (src/services/roomPolicy.service.js:87:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:154:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:156:10)

  ΓùÅ RoomPolicy Service ΓÇ║ getPoliciesByType ΓÇ║ should return active policies by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getPoliciesByType ΓÇ║ should return inactive policies when specified

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ calculateRefund ΓÇ║ should throw error for invalid policy type

    expect(received).toThrow(expected)

    Expected substring: "Invalid cancellation policy"
    Received message:   "400"

        [0m [90m 110 |[39m   calculateRefund(cancellationPolicy[33m,[39m bookingStartTime[33m,[39m cancellationTime[33m,[39m bookingAmount) {
         [90m 111 |[39m     [36mif[39m ([33m![39mcancellationPolicy [33m||[39m cancellationPolicy[33m.[39mtype [33m!==[39m 
[32m'CANCELLATION'[39m) {
        [31m[1m>[22m[39m[90m 112 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid cancellation 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 113 |[39m     }
         [90m 114 |[39m
         [90m 115 |[39m     [36mconst[39m hoursBeforeBooking [33m=[39m [33mMath[39m[33m.[39mfloor([0m

      at RoomPolicyService.calculateRefund (src/services/roomPolicy.service.js:112:13)
      at calculateRefund (src/tests/unit/services/roomPolicy.service.test.js:261:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:266:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:266:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateRefund ΓÇ║ should throw error for null policy

    expect(received).toThrow(expected)

    Expected substring: "Invalid cancellation policy"
    Received message:   "400"

        [0m [90m 110 |[39m   calculateRefund(cancellationPolicy[33m,[39m bookingStartTime[33m,[39m cancellationTime[33m,[39m bookingAmount) {
         [90m 111 |[39m     [36mif[39m ([33m![39mcancellationPolicy [33m||[39m cancellationPolicy[33m.[39mtype [33m!==[39m 
[32m'CANCELLATION'[39m) {
        [31m[1m>[22m[39m[90m 112 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid cancellation 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 113 |[39m     }
         [90m 114 |[39m
         [90m 115 |[39m     [36mconst[39m hoursBeforeBooking [33m=[39m [33mMath[39m[33m.[39mfloor([0m

      at RoomPolicyService.calculateRefund (src/services/roomPolicy.service.js:112:13)
      at calculateRefund (src/tests/unit/services/roomPolicy.service.test.js:270:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:275:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:275:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateNoShowCharge ΓÇ║ should throw error for invalid policy type

    expect(received).toThrow(expected)

    Expected substring: "Invalid no-show policy"
    Received message:   "400"

        [0m [90m 154 |[39m   calculateNoShowCharge(noShowPolicy[33m,[39m bookingStartTime[33m,[39m checkInTime[33m,[39m bookingAmount[33m,[39m 
previousNoShowCount [33m=[39m [35m0[39m) {
         [90m 155 |[39m     [36mif[39m ([33m![39mnoShowPolicy [33m||[39m noShowPolicy[33m.[39mtype [33m!==[39m [32m'NO_SHOW'[39m) {
        [31m[1m>[22m[39m[90m 156 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Invalid no-show 
policy"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 157 |[39m     }
         [90m 158 |[39m
         [90m 159 |[39m     [36mconst[39m rules [33m=[39m noShowPolicy[33m.[39mnoShowRules[33m;[39m[0m

      at RoomPolicyService.calculateNoShowCharge (src/services/roomPolicy.service.js:156:13)
      at calculateNoShowCharge (src/tests/unit/services/roomPolicy.service.test.js:435:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:440:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:440:10)

  ΓùÅ RoomPolicy Service ΓÇ║ calculateNoShowCharge ΓÇ║ should throw error for unknown charge type

    expect(received).toThrow(expected)

    Expected substring: "Unknown charge type"
    Received message:   "400"

        [0m [90m 231 |[39m
         [90m 232 |[39m       [36mdefault[39m[33m:[39m
        [31m[1m>[22m[39m[90m 233 |[39m         [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m"Unknown charge 
type"[39m)[33m;[39m
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 234 |[39m     }
         [90m 235 |[39m   }
         [90m 236 |[39m[0m

      at RoomPolicyService.calculateNoShowCharge (src/services/roomPolicy.service.js:233:15)
      at calculateNoShowCharge (src/tests/unit/services/roomPolicy.service.test.js:451:38)
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:456:10)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:456:10)

  ΓùÅ RoomPolicy Service ΓÇ║ updatePolicy ΓÇ║ should update policy

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ updatePolicy ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "400"

        [0m [90m 252 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 253 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 254 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m400[39m[33m,[39m [32m`Failed to update 
policy: ${error.message}`[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 255 |[39m     }
         [90m 256 |[39m   }
         [90m 257 |[39m[0m

      at RoomPolicyService.updatePolicy (src/services/roomPolicy.service.js:254:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:481:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:483:10)

  ΓùÅ RoomPolicy Service ΓÇ║ deletePolicy ΓÇ║ should soft delete policy by setting isActive to false

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ deletePolicy ΓÇ║ should throw error for non-existent policy

    expect(received).rejects.toThrow(expected)

    Expected substring: "Policy not found"
    Received message:   "500"

        [0m [90m 273 |[39m       [36mreturn[39m policy[33m;[39m
         [90m 274 |[39m     } [36mcatch[39m (error) {
        [31m[1m>[22m[39m[90m 275 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([35m500[39m[33m,[39m [32m`Failed to delete 
policy: ${error.message}`[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 276 |[39m     }
         [90m 277 |[39m   }
         [90m 278 |[39m[0m

      at RoomPolicyService.deletePolicy (src/services/roomPolicy.service.js:275:13)
      at Object.<anonymous> (src/tests/unit/services/roomPolicy.service.test.js:509:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/roomPolicy.service.test.js:511:10)

  ΓùÅ RoomPolicy Service ΓÇ║ getAllActivePolicies ΓÇ║ should return active policies grouped by type

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ RoomPolicy Service ΓÇ║ getAllActivePolicies ΓÇ║ should not include inactive policies

    ValidationError: RoomPolicy validation failed: category: `BOOKING` is not a valid enum value for path `category`.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

FAIL src/tests/unit/services/service.service.test.js
  ΓùÅ Service Service ΓÇ║ getAvailableServices ΓÇ║ should return only active and available services

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [{"_id": "6939ca3ca0d84a59053fef8e", "description": "", "name": "Active Service", "pricePerUse": 100000}, {"_id": 
"6939ca3ca0d84a59053fef90", "description": "", "name": "Active Unavailable", "pricePerUse": 300000}]

    [0m [90m 115 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getAvailableServices()[33m;[39m
     [90m 116 |[39m
    [31m[1m>[22m[39m[90m 117 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 118 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Active Service'[39m)[33m;[39m
     [90m 119 |[39m     })[33m;[39m
     [90m 120 |[39m[0m

      at Object.toHaveLength (src/tests/unit/services/service.service.test.js:117:22)

  ΓùÅ Service Service ΓÇ║ getAvailableServiceDetail ΓÇ║ should throw error for unavailable service

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"_id": "6939ca3ca0d84a59053fefb5", "description": "", "name": "Unavailable", "pricePerUse": 100000}

    [0m [90m 181 |[39m       })[33m;[39m
     [90m 182 |[39m
    [31m[1m>[22m[39m[90m 183 |[39m       [36mawait[39m expect(getAvailableServiceDetail(service[33m.[39m_id))
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 184 |[39m         [33m.[39mrejects
     [90m 185 |[39m         [33m.[39mtoThrow([33mNotFoundError[39m)[33m;[39m
     [90m 186 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.expect (src/tests/unit/services/service.service.test.js:183:13)

  ΓùÅ Service Service ΓÇ║ deleteService ΓÇ║ should throw error if service is in use in bookings

    ValidationError: BookingDetail validation failed: pricePerUnit: Path `pricePerUnit` is required., detailType: Path `detailType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

FAIL src/tests/unit/services/payment.service.test.js
  ΓùÅ Test suite failed to run

    SyntaxError: The requested module '../../../services/payment.service.js' does not provide an export named 'getPaymentById'

      at Runtime.linkAndEvaluateModule (node_modules/jest-runtime/build/index.js:684:5)

FAIL src/tests/unit/services/equipment.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 22 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 23 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 24 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 25 |[39m
     [90m 26 |[39m describe([32m'Equipment Service'[39m[33m,[39m () [33m=>[39m {
     [90m 27 |[39m   [90m// #region Get Equipment Tests[39m[0m

      at require (src/tests/unit/services/equipment.service.test.js:24:5)
      at _getJestObj (src/tests/unit/services/equipment.service.test.js:22:1)

FAIL src/tests/unit/services/auth.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 36 |[39m jest[33m.[39mmock([32m'../../../services/notification.service.js'[39m[33m,[39m () [33m=>[39m ({
     [90m 37 |[39m   createAndSendNotification[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 38 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 39 |[39m
     [90m 40 |[39m describe([32m'Auth Service'[39m[33m,[39m () [33m=>[39m {
     [90m 41 |[39m   [90m// #region Helper Functions Tests[39m[0m

      at require (src/tests/unit/services/auth.service.test.js:38:5)
      at _getJestObj (src/tests/unit/services/auth.service.test.js:31:1)

FAIL src/tests/unit/services/booking.service.test.js
  ΓùÅ Test suite failed to run

    ReferenceError: require is not defined

    [0m [90m 34 |[39m   acquireLock[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([32m'mock-lock-token'[39m)[33m,[39m
     [90m 35 |[39m   releaseLock[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue([36mtrue[39m)[33m,[39m
    [31m[1m>[22m[39m[90m 36 |[39m }))[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 37 |[39m
     [90m 38 |[39m describe([32m'Booking Service'[39m[33m,[39m () [33m=>[39m {
     [90m 39 |[39m   [36mlet[39m testUser[33m;[39m[0m

      at require (src/tests/unit/services/booking.service.test.js:36:5)
      at _getJestObj (src/tests/unit/services/booking.service.test.js:21:1)

FAIL src/tests/unit/middlewares/auth.test.js (8.428 s)
  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should allow access with valid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:26:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request without token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:38:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request with invalid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:55:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request with expired token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:78:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request for non-existent user

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:100:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should reject request for inactive user

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:123:19)

  ΓùÅ Auth Middleware ΓÇ║ protect ΓÇ║ should handle malformed authorization header

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:139:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should attach user if valid token provided

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:166:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should continue without user if no token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:178:19)

  ΓùÅ Auth Middleware ΓÇ║ optionalProtect ΓÇ║ should continue without user if invalid token

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:191:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should allow access for authorized role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:207:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should allow access when role is in array

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:219:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should reject access for unauthorized role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:231:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should work with single role

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:248:19)

  ΓùÅ Auth Middleware ΓÇ║ authorize ΓÇ║ should reject when user role not in allowed roles

    ReferenceError: jest is not defined

    [0m [90m 224 |[39m [36mexport[39m [36mconst[39m createMockResponse [33m=[39m () [33m=>[39m {
     [90m 225 |[39m   [36mconst[39m res [33m=[39m {}[33m;[39m
    [31m[1m>[22m[39m[90m 226 |[39m   res[33m.[39mstatus [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 227 |[39m   res[33m.[39mjson [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 228 |[39m   res[33m.[39msend [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m
     [90m 229 |[39m   res[33m.[39mcookie [33m=[39m jest[33m.[39mfn()[33m.[39mmockReturnValue(res)[33m;[39m[0m

      at jest (src/tests/mocks/factories.js:226:16)
      at Object.createMockResponse (src/tests/unit/middlewares/auth.test.js:260:19)

FAIL src/tests/unit/services/schedule.service.test.js (8.539 s)
  ΓùÅ Schedule Service ΓÇ║ deleteSchedule ΓÇ║ should delete available schedule

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 361 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteSchedule(schedule[33m.[39m_id)[33m;[39m
     [90m 362 |[39m
    [31m[1m>[22m[39m[90m 363 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 364 |[39m
     [90m 365 |[39m       [36mconst[39m deleted [33m=[39m [36mawait[39m [33mSchedule[39m[33m.[39mfindById(schedule[33m.[39m_id)[33m;[39m
     [90m 366 |[39m       expect(deleted)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.toBeDefined (src/tests/unit/services/schedule.service.test.js:363:30)

FAIL src/tests/integration/auth.api.test.js (12.837 s)
  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should register a new customer

    expected "Content-Type" matching /json/, got "text/html; charset=utf-8"

    [0m [90m 54 |[39m         [33m.[39mpost([32m'/api/auth/register'[39m)
     [90m 55 |[39m         [33m.[39msend(userData)
    [31m[1m>[22m[39m[90m 56 |[39m         [33m.[39mexpect([32m'Content-Type'[39m[33m,[39m [35m/json/[39m)[33m;[39m
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 57 |[39m
     [90m 58 |[39m       [90m// Could be 201 (created) or could fail if validation middleware not properly set up[39m
     [90m 59 |[39m       [90m// Adjust based on actual API behavior[39m[0m

      at Object.expect (src/tests/integration/auth.api.test.js:56:10)
      ----
      at Test._assertHeader (node_modules/supertest/lib/test.js:289:16)
      at node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/supertest/lib/test.js:152:11)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject registration with invalid email

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 422]

    [0m [90m 73 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m       expect([[35m400[39m[33m,[39m [35m422[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 76 |[39m     })[33m;[39m
     [90m 77 |[39m
     [90m 78 |[39m     it([32m'should reject registration with weak password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:75:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject registration with weak password

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 422]

    [0m [90m 88 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 89 |[39m
    [31m[1m>[22m[39m[90m 90 |[39m       expect([[35m400[39m[33m,[39m [35m422[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m
     [90m 93 |[39m     it([32m'should reject duplicate username'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:90:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject duplicate username

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 409]

    [0m [90m 105 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m       expect([[35m400[39m[33m,[39m [35m409[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 108 |[39m     })[33m;[39m
     [90m 109 |[39m
     [90m 110 |[39m     it([32m'should reject duplicate email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:107:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/register ΓÇ║ should reject duplicate email

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 409]

    [0m [90m 122 |[39m         [33m.[39msend(userData)[33m;[39m
     [90m 123 |[39m
    [31m[1m>[22m[39m[90m 124 |[39m       expect([[35m400[39m[33m,[39m [35m409[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 125 |[39m     })[33m;[39m
     [90m 126 |[39m   })[33m;[39m
     [90m 127 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:124:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should login with valid credentials

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [200, 401]

    [0m [90m 151 |[39m
     [90m 152 |[39m       [90m// Could be 200 (success) or 401 (if user not verified or password hash issue)[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 154 |[39m     })[33m;[39m
     [90m 155 |[39m
     [90m 156 |[39m     it([32m'should reject login with invalid password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:153:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with invalid password

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

    [0m [90m 162 |[39m         })[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 165 |[39m     })[33m;[39m
     [90m 166 |[39m
     [90m 167 |[39m     it([32m'should reject login with non-existent email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/tests/integration/auth.api.test.js:164:31)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with non-existent email

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [401, 404]

    [0m [90m 173 |[39m         })[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       expect([[35m401[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 176 |[39m     })[33m;[39m
     [90m 177 |[39m
     [90m 178 |[39m     it([32m'should reject login with missing fields'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:175:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should verify email with valid code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 205 |[39m         })[33m;[39m
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 208 |[39m     })[33m;[39m
     [90m 209 |[39m
     [90m 210 |[39m     it([32m'should reject invalid verification code'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:207:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should reject invalid verification code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 223 |[39m         })[33m;[39m
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m     })[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m     it([32m'should reject expired verification code'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:225:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/verify-email ΓÇ║ should reject expired verification code

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 241 |[39m         })[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 244 |[39m     })[33m;[39m
     [90m 245 |[39m   })[33m;[39m
     [90m 246 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:243:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/refresh-token ΓÇ║ should reject without refresh token

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 294 |[39m         [33m.[39msend({})[33m;[39m
     [90m 295 |[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should reject invalid refresh token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:296:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/refresh-token ΓÇ║ should reject invalid refresh token

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 401]

    [0m [90m 302 |[39m         [33m.[39msend({ refreshToken[33m:[39m [32m'invalid-token'[39m })[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect([[35m400[39m[33m,[39m [35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:304:26)

  ΓùÅ Auth API Integration Tests ΓÇ║ POST /api/auth/logout ΓÇ║ should accept logout request

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 204, 400, 401]

    [0m [90m 315 |[39m
     [90m 316 |[39m       [90m// Logout typically succeeds even with invalid token[39m
    [31m[1m>[22m[39m[90m 317 |[39m       expect([[35m200[39m[33m,[39m [35m204[39m[33m,[39m [35m400[39m[33m,[39m 
[35m401[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 318 |[39m     })[33m;[39m
     [90m 319 |[39m   })[33m;[39m
     [90m 320 |[39m   [90m// #endregion[39m[0m

      at Object.toContain (src/tests/integration/auth.api.test.js:317:36)

FAIL src/tests/integration/booking.api.test.js (16.148 s)
  ΓùÅ Booking API Integration Tests ΓÇ║ PUT /api/bookings/:id/status ΓÇ║ should reject status update by customer

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [401, 403]

    [0m [90m 298 |[39m         [33m.[39msend({ status[33m:[39m [33mBOOKING_STATUS[39m[33m.[39m[33mCONFIRMED[39m })[33m;[39m
     [90m 299 |[39m
    [31m[1m>[22m[39m[90m 300 |[39m       expect([[35m401[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 301 |[39m     })[33m;[39m
     [90m 302 |[39m
     [90m 303 |[39m     it([32m'should reject without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/booking.api.test.js:300:26)

  ΓùÅ Booking API Integration Tests ΓÇ║ GET /api/bookings/my-bookings ΓÇ║ should return customer own bookings

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [200, 401, 403]

    [0m [90m 366 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${customerToken}`[39m)[33m;[39m
     [90m 367 |[39m
    [31m[1m>[22m[39m[90m 368 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m 
[35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 369 |[39m     })[33m;[39m
     [90m 370 |[39m
     [90m 371 |[39m     it([32m'should reject without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/booking.api.test.js:368:31)

FAIL src/tests/unit/services/report.service.test.js (21.387 s)
  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should create report with valid data for booking

    Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc

    [0m [90m 29 |[39m
     [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 32 |[39m     }
     [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
     [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:58:28)

  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should throw error if target does not exist

    expect(received).rejects.toThrow(expected)

    Expected constructor: NotFoundError
    Received constructor: ValidationError

    Received message: "Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc"

        [0m [90m 29 |[39m
         [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
        [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 32 |[39m     }
         [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
         [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:223:20)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (src/tests/unit/services/report.service.test.js:225:10)

  ΓùÅ Report Service ΓÇ║ createReport ΓÇ║ should use bookingId as targetId for backward compatibility

    Loß║íi vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc

    [0m [90m 29 |[39m
     [90m 30 |[39m     [36mif[39m ([33m![39mdata[33m.[39missueType) {
    [31m[1m>[22m[39m[90m 31 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'Loß║íi vß║Ñn ─æß╗ü l├á bß║»t 
buß╗Öc'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 32 |[39m     }
     [90m 33 |[39m     [36mif[39m ([33m![39mdata[33m.[39mdescription [33m||[39m data[33m.[39mdescription[33m.[39mtrim()[33m.[39mlength 
[33m===[39m [35m0[39m) {
     [90m 34 |[39m       [36mthrow[39m [36mnew[39m [33mValidationError[39m([32m'M├┤ tß║ú vß║Ñn ─æß╗ü l├á bß║»t buß╗Öc'[39m)[33m;[39m[0m

      at createReport (src/services/report.service.js:31:13)
      at Object.createReport (src/tests/unit/services/report.service.test.js:236:28)

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should return all reports

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by issueType

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should filter by priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid status filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid issueType filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReports ΓÇ║ should throw error for invalid priority filter

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for admin

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for staff

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should return report by id for owner

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ getReportById ΓÇ║ should throw error if user not authorized

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update report status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update report priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update compensationAmount

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should update description

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if update data is empty

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for invalid status

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for invalid priority

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for negative compensationAmount

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error for empty description

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ updateReport ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should delete report

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should throw error if id is missing

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ deleteReport ΓÇ║ should throw error if report not found

    ValidationError: Report validation failed: issueType: Path `issueType` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ΓùÅ Report Service ΓÇ║ Report Constants ΓÇ║ should have all report statuses

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 522 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mIN_PROGRESS[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m 523 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mRESOLVED[39m)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 524 |[39m       expect([33mREPORT_STATUS[39m[33m.[39m[33mREJECTED[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 525 |[39m     })[33m;[39m
     [90m 526 |[39m
     [90m 527 |[39m     it([32m'should have report issue types'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBeDefined (src/tests/unit/services/report.service.test.js:524:38)

  ΓùÅ Report Service ΓÇ║ Report Constants ΓÇ║ should have report issue types

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 526 |[39m
     [90m 527 |[39m     it([32m'should have report issue types'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 528 |[39m       expect([33mREPORT_ISSUE_TYPE[39m[33m.[39m[33mEQUIPMENT_DAMAGE[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 529 |[39m       expect([33mREPORT_ISSUE_TYPE[39m[33m.[39m[33mOTHER[39m)[33m.[39mtoBeDefined()[33m;[39m
     [90m 530 |[39m     })[33m;[39m
     [90m 531 |[39m   })[33m;[39m[0m

      at Object.toBeDefined (src/tests/unit/services/report.service.test.js:528:50)


Test Suites: 18 failed, 3 passed, 21 total
Tests:       94 failed, 216 passed, 310 total
Snapshots:   0 total
Time:        25.53 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
{
  "error": {
    "code": 1,
    "summary": "",
    "detail": ""
  }
}
